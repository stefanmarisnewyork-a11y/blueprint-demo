<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>BluePrint AI — Advanced Audience Segmentation</title>
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; background: #f8fafc; color: #111827; -webkit-font-smoothing: antialiased; }
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 3px; }

.header { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); padding: 20px 32px; display: flex; align-items: center; justify-content: space-between; }
.header-logo { width: 36px; height: 36px; border-radius: 8px; background: linear-gradient(135deg, #3b82f6, #8b5cf6); display: flex; align-items: center; justify-content: center; font-size: 18px; font-weight: 700; color: #fff; }
.header-left { display: flex; align-items: center; gap: 16px; }
.header-title { color: #fff; font-size: 16px; font-weight: 700; letter-spacing: -0.3px; }
.header-sub { color: #94a3b8; font-size: 11px; }
.badges { display: flex; gap: 8px; }

.badge { display: inline-flex; align-items: center; padding: 2px 10px; border-radius: 20px; font-size: 11px; font-weight: 600; letter-spacing: 0.3px; }
.badge-solid { color: #fff; }
.badge-outline { background: transparent; }

.stepper { background: #fff; border-bottom: 1px solid #e5e7eb; padding: 12px 32px; display: flex; align-items: center; gap: 8px; }
.step-circle { width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 600; }
.step-label { font-size: 12px; }
.step-line { width: 32px; height: 1px; }
.btn-back { background: none; border: 1px solid #d1d5db; border-radius: 6px; padding: 4px 12px; cursor: pointer; font-size: 12px; color: #6b7280; margin-right: 8px; font-family: inherit; }
.btn-reset { margin-left: auto; background: none; border: none; cursor: pointer; font-size: 12px; color: #6b7280; text-decoration: underline; font-family: inherit; }

.content { max-width: 1200px; margin: 0 auto; padding: 24px 32px; }

.card { background: #fff; border-radius: 12px; border: 1px solid #e5e7eb; padding: 20px; transition: all 0.2s; }
.card-hover:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.08); border-color: #c7d2fe; }
.card-click { cursor: pointer; }

.grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; }
.grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
.grid-side { display: grid; grid-template-columns: 280px 1fr; gap: 16px; }

.env-card { position: relative; overflow: hidden; }
.env-stripe { position: absolute; top: 0; left: 0; width: 4px; height: 100%; }
.env-content { padding-left: 8px; }

.show-tag { font-size: 11px; color: #6b7280; background: #f3f4f6; padding: 2px 8px; border-radius: 4px; display: inline-block; margin: 2px; }

.insight-box { margin-top: 24px; background: linear-gradient(135deg, #eff6ff, #f5f3ff); border-radius: 12px; padding: 20px; border: 1px solid #c7d2fe; display: flex; align-items: flex-start; gap: 12px; }

.epg-card { background: #fef3c7; border-color: #f59e0b; }
.epg-label { font-size: 11px; font-weight: 600; color: #92400e; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; }
.epg-value { font-size: 36px; font-weight: 700; color: #92400e; margin-bottom: 4px; }
.epg-desc { font-size: 12px; color: #92400e; }
.epg-cpm { margin-top: 16px; padding-top: 12px; border-top: 1px dashed #f59e0b; }

.bp-label { font-size: 11px; font-weight: 600; color: #2563eb; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; }

.cluster-item { padding: 14px 16px; border-radius: 10px; cursor: pointer; transition: all 0.2s; display: flex; justify-content: space-between; align-items: center; }
.cluster-check { width: 20px; height: 20px; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #fff; flex-shrink: 0; }

.btn-create { background: linear-gradient(135deg, #2563eb, #7c3aed); color: #fff; border: none; border-radius: 8px; padding: 10px 24px; font-size: 13px; font-weight: 600; cursor: pointer; font-family: inherit; }
.btn-create:hover { opacity: 0.9; }

.kpi-label { font-size: 11px; color: #6b7280; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; }
.kpi-value { font-size: 28px; font-weight: 700; }
.kpi-sub { font-size: 11px; color: #9ca3af; margin-top: 4px; }

.revenue-card { background: linear-gradient(135deg, #0f172a, #1e293b); color: #fff; }
.rev-label { font-size: 11px; color: #94a3b8; margin-bottom: 4px; }
.rev-sub { font-size: 11px; color: #64748b; }

.adv-row { display: flex; align-items: center; gap: 12px; margin-bottom: 10px; }
.adv-icon { width: 32px; height: 32px; border-radius: 8px; background: #f3f4f6; display: flex; align-items: center; justify-content: center; font-size: 16px; flex-shrink: 0; }
.adv-bar-bg { width: 100%; background: #e5e7eb; border-radius: 3px; height: 6px; overflow: hidden; }
.adv-bar-fill { height: 100%; background: #059669; border-radius: 3px; transition: width 0.6s; }

.samsung-callout { margin-top: 20px; padding: 16px; border-radius: 12px; border: 2px solid #059669; background: #f0fdf4; display: flex; align-items: center; gap: 12px; }
.samsung-dot { width: 36px; height: 36px; border-radius: 50%; background: #059669; display: flex; align-items: center; justify-content: center; color: #fff; font-size: 16px; font-weight: 700; flex-shrink: 0; }

.segment-box { padding: 12px; background: #f8fafc; border-radius: 8px; border: 1px solid #e5e7eb; }

.footer { border-top: 1px solid #e5e7eb; padding: 12px 32px; display: flex; justify-content: space-between; align-items: center; margin-top: 40px; background: #fff; font-size: 11px; color: #9ca3af; }

/* Bar chart styles */
.bar-chart { display: flex; flex-direction: column; gap: 8px; }
.bar-row { display: flex; align-items: center; gap: 8px; }
.bar-label { width: 130px; font-size: 10px; color: #6b7280; text-align: right; flex-shrink: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.bar-container { flex: 1; display: flex; gap: 4px; align-items: center; }
.bar { height: 14px; border-radius: 0 4px 4px 0; transition: width 0.6s; }
.bar-value { font-size: 10px; color: #6b7280; min-width: 24px; }

/* Stacked area chart (simplified as stacked bars) */
.stacked-chart { display: flex; align-items: flex-end; gap: 6px; height: 180px; padding-top: 20px; }
.stacked-col { display: flex; flex-direction: column; flex: 1; align-items: center; }
.stacked-bar { width: 100%; transition: height 0.4s; }
.stacked-label { font-size: 10px; color: #9ca3af; margin-top: 4px; }
.chart-legend { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px; }
.legend-item { display: flex; align-items: center; gap: 4px; font-size: 10px; color: #6b7280; }
.legend-dot { width: 8px; height: 8px; border-radius: 2px; flex-shrink: 0; }
</style>
</head>
<body>

<div id="app"></div>

<script>
// ─── DATA ────────────────────────────────────────────────────────────────────
var COLORS = ["#2563eb","#059669","#7c3aed","#dc2626","#f59e0b","#06b6d4","#ec4899","#84cc16"];

var ENVS = [
  { id:"sports", name:"Sports Programming", epg:"Sports", color:"#2563eb", icon:"\u26A1",
    shows:[
      { id:"espn_sc", name:"SportsCenter", net:"ESPN", slots:"6AM, 11PM ET Daily",
        data:[{w:"W1",vals:[35,25,15,15,10]},{w:"W2",vals:[38,22,14,16,10]},{w:"W3",vals:[42,18,12,18,10]},{w:"W4",vals:[45,15,10,20,10]},{w:"W5",vals:[48,12,8,22,10]},{w:"W6",vals:[50,10,8,22,10]}],
        keys:["NBA","NFL","MLB","Analysis","Other"],
        clusters:["NBA-Heavy","NFL Loyalist","Analysis-Oriented","Highlights-Only"]},
      { id:"mnf", name:"Monday Night Football", net:"ESPN/ABC", slots:"Mon 8:15PM ET",
        data:[{w:"W1",vals:[65,20,10,5]},{w:"W2",vals:[62,22,12,4]},{w:"W3",vals:[58,25,13,4]},{w:"W4",vals:[55,28,14,3]},{w:"W5",vals:[52,30,15,3]},{w:"W6",vals:[50,32,15,3]}],
        keys:["Primetime","Casual","Betting","Social"],
        clusters:["Primetime Loyalist","Casual Viewer","Betting-Engaged","Social Viewer"]},
      { id:"nba_tnt", name:"NBA on TNT", net:"TNT", slots:"Tue/Thu 7:30PM ET",
        data:[{w:"W1",vals:[30,22,18,20,10]},{w:"W2",vals:[32,20,20,18,10]},{w:"W3",vals:[28,24,22,16,10]},{w:"W4",vals:[35,18,20,17,10]},{w:"W5",vals:[33,22,19,16,10]},{w:"W6",vals:[34,21,20,15,10]}],
        keys:["Lakers","Celtics","Warriors","General","Betting"],
        clusters:["Lakers-Dominant","Celtics Loyalist","Warriors Fan","General NBA","Betting-Active"]},
      { id:"ufc", name:"UFC Fight Night", net:"ESPN+", slots:"Sat 7PM ET",
        data:[{w:"W1",vals:[45,25,20,10]},{w:"W2",vals:[48,22,20,10]},{w:"W3",vals:[50,20,18,12]},{w:"W4",vals:[52,18,17,13]},{w:"W5",vals:[55,15,16,14]},{w:"W6",vals:[58,14,14,14]}],
        keys:["Hardcore","PPV-Only","Casual","Betting"],
        clusters:["Hardcore MMA","PPV-Only","Casual Combat","Betting-Engaged"]}
    ]},
  { id:"news", name:"National News", epg:"News", color:"#059669", icon:"\uD83D\uDCF0",
    shows:[
      { id:"cnn", name:"CNN Tonight", net:"CNN", slots:"9PM ET Weeknights",
        data:[{w:"W1",vals:[40,25,15,12,8]},{w:"W2",vals:[38,28,14,12,8]},{w:"W3",vals:[35,30,15,12,8]},{w:"W4",vals:[42,22,16,12,8]},{w:"W5",vals:[45,20,15,12,8]},{w:"W6",vals:[40,25,15,12,8]}],
        keys:["Politics","Economy","Health","World","Tech"],
        clusters:["Economy-Focused","Political Junkie","Health-Aware","World Affairs"]},
      { id:"fox", name:"Fox News Primetime", net:"Fox News", slots:"8PM ET Weeknights",
        data:[{w:"W1",vals:[50,20,15,10,5]},{w:"W2",vals:[48,22,15,10,5]},{w:"W3",vals:[52,18,15,10,5]},{w:"W4",vals:[55,15,15,10,5]},{w:"W5",vals:[50,20,15,10,5]},{w:"W6",vals:[48,22,15,10,5]}],
        keys:["Politics","Economy","Culture","Security","Other"],
        clusters:["Economy-Focused","Political-Engaged","Culture-Oriented","Security-Minded"]},
      { id:"msnbc", name:"Morning Joe", net:"MSNBC", slots:"6-9AM ET Weekdays",
        data:[{w:"W1",vals:[35,30,20,10,5]},{w:"W2",vals:[38,28,18,11,5]},{w:"W3",vals:[40,25,20,10,5]},{w:"W4",vals:[42,24,18,11,5]},{w:"W5",vals:[38,28,20,9,5]},{w:"W6",vals:[36,30,20,9,5]}],
        keys:["Markets","Politics","Policy","Media","Other"],
        clusters:["Market-Watcher","Policy-Deep","Media-Engaged","Early Riser Professional"]}
    ]},
  { id:"lifestyle", name:"Morning / Lifestyle / Talk", epg:"Lifestyle / Talk", color:"#7c3aed", icon:"\u2600\uFE0F",
    shows:[
      { id:"today", name:"Today Show", net:"NBC", slots:"7-11AM ET Weekdays",
        data:[{w:"W1",vals:[30,22,20,15,13]},{w:"W2",vals:[32,20,22,14,12]},{w:"W3",vals:[28,24,20,16,12]},{w:"W4",vals:[35,18,22,13,12]},{w:"W5",vals:[33,20,20,15,12]},{w:"W6",vals:[34,19,21,14,12]}],
        keys:["Parenting","Cooking","Health","Travel","Fashion"],
        clusters:["Parenting-Active","Cooking Enthusiast","Health-Oriented","Travel-Aspirational"]},
      { id:"gma", name:"Good Morning America", net:"ABC", slots:"7-9AM ET Weekdays",
        data:[{w:"W1",vals:[28,25,20,15,12]},{w:"W2",vals:[30,23,22,14,11]},{w:"W3",vals:[26,27,20,16,11]},{w:"W4",vals:[32,22,18,17,11]},{w:"W5",vals:[29,24,21,15,11]},{w:"W6",vals:[30,24,20,15,11]}],
        keys:["Family","Wellness","Home","Finance","Entertainment"],
        clusters:["Family-Focused","Wellness-Oriented","Home Improver","Finance-Aware"]},
      { id:"theview", name:"The View", net:"ABC", slots:"11AM ET Weekdays",
        data:[{w:"W1",vals:[35,25,20,12,8]},{w:"W2",vals:[33,28,18,13,8]},{w:"W3",vals:[37,22,22,11,8]},{w:"W4",vals:[34,26,20,12,8]},{w:"W5",vals:[36,24,20,12,8]},{w:"W6",vals:[35,25,20,12,8]}],
        keys:["Culture","Politics","Celebrity","Health","Lifestyle"],
        clusters:["Culture-Engaged","Politically-Active","Celebrity-Follower","Health-Conscious"]}
    ]},
  { id:"ent", name:"Primetime Entertainment", epg:"Entertainment", color:"#dc2626", icon:"\uD83C\uDFAC",
    shows:[
      { id:"bach", name:"The Bachelor", net:"ABC", slots:"Mon 8PM ET",
        data:[{w:"W1",vals:[40,25,20,10,5]},{w:"W2",vals:[42,23,22,8,5]},{w:"W3",vals:[45,20,22,8,5]},{w:"W4",vals:[48,18,22,7,5]},{w:"W5",vals:[50,16,22,7,5]},{w:"W6",vals:[52,15,22,6,5]}],
        keys:["Romance","Drama","Social","Fashion","Travel"],
        clusters:["Romance-Engaged","Drama-Seeker","Social Viewer","Fashion-Forward"]},
      { id:"surv", name:"Survivor", net:"CBS", slots:"Wed 8PM ET",
        data:[{w:"W1",vals:[35,28,22,10,5]},{w:"W2",vals:[38,26,22,9,5]},{w:"W3",vals:[40,25,21,9,5]},{w:"W4",vals:[42,23,21,9,5]},{w:"W5",vals:[44,22,20,9,5]},{w:"W6",vals:[45,21,20,9,5]}],
        keys:["Strategy","Adventure","Social","Fitness","Other"],
        clusters:["Strategy-Obsessed","Adventure-Seeker","Social Dynamics Fan","Fitness-Oriented"]}
    ]}
];

var AUD = {
  "NBA-Heavy":{name:"NBA-Dominant Households",desc:"Households where 40%+ of sports viewing is NBA content, sustained over 4+ weeks",size:"2.4M HHs",n:2400000,conf:94,base:8,prem:28,advs:[{n:"Nike Basketball",i:"\uD83C\uDFC0",f:97},{n:"State Farm",i:"\uD83C\uDFE0",f:89},{n:"DraftKings",i:"\uD83C\uDFB0",f:85},{n:"Gatorade",i:"\u26A1",f:82}]},
  "NFL Loyalist":{name:"NFL Primetime Loyalists",desc:"Consistent NFL viewers who watch 60%+ of primetime games",size:"8.1M HHs",n:8100000,conf:91,base:8,prem:22,advs:[{n:"Fanatics",i:"\uD83C\uDFC8",f:96},{n:"Bud Light",i:"\uD83C\uDF7A",f:92},{n:"Ford",i:"\uD83D\uDE97",f:88},{n:"Papa Johns",i:"\uD83C\uDF55",f:84}]},
  "Analysis-Oriented":{name:"Betting & Analysis-Oriented",desc:"Viewers with high affinity for odds, statistics, and tactical breakdowns",size:"1.8M HHs",n:1800000,conf:88,base:8,prem:35,advs:[{n:"DraftKings",i:"\uD83C\uDFB0",f:98},{n:"FanDuel",i:"\uD83D\uDCCA",f:96},{n:"Charles Schwab",i:"\uD83D\uDCB9",f:82},{n:"MGM BetMGM",i:"\uD83C\uDFB2",f:90}]},
  "Highlights-Only":{name:"Highlights-Only Viewers",desc:"Quick-consumption sports viewers \u2014 catch scores and highlights, rarely full games",size:"5.2M HHs",n:5200000,conf:86,base:8,prem:14,advs:[{n:"YouTube TV",i:"\uD83D\uDCFA",f:90},{n:"ESPN+",i:"\uD83D\uDCF1",f:88},{n:"Uber Eats",i:"\uD83C\uDF54",f:80}]},
  "Primetime Loyalist":{name:"Primetime Sports Loyalists",desc:"Appointment viewers who consistently watch major primetime sporting events",size:"6.5M HHs",n:6500000,conf:92,base:8,prem:24,advs:[{n:"Toyota",i:"\uD83D\uDE97",f:91},{n:"Verizon",i:"\uD83D\uDCF1",f:88},{n:"Geico",i:"\uD83E\uDD8E",f:86}]},
  "Casual Viewer":{name:"Casual Sports Viewers",desc:"Lean-back viewers who tune in occasionally, often for big moments only",size:"12.0M HHs",n:12000000,conf:82,base:8,prem:12,advs:[{n:"Amazon Prime",i:"\uD83D\uDCE6",f:85},{n:"T-Mobile",i:"\uD83D\uDCF1",f:82}]},
  "Betting-Engaged":{name:"Betting-Engaged Households",desc:"Cross-sport betting-oriented viewers with high odds engagement",size:"3.1M HHs",n:3100000,conf:90,base:8,prem:38,advs:[{n:"DraftKings",i:"\uD83C\uDFB0",f:98},{n:"FanDuel",i:"\uD83D\uDCCA",f:97},{n:"Caesars",i:"\uD83C\uDFDB",f:93},{n:"BetMGM",i:"\uD83C\uDFB2",f:91}]},
  "Social Viewer":{name:"Social-First Viewers",desc:"Viewers who engage heavily on second screens during live events",size:"4.8M HHs",n:4800000,conf:84,base:8,prem:18,advs:[{n:"Meta",i:"\uD83D\uDCD8",f:90},{n:"TikTok",i:"\uD83C\uDFB5",f:88}]},
  "Lakers-Dominant":{name:"Lakers-Dominant Households",desc:"NBA viewers with 30%+ viewing concentrated on Lakers games",size:"1.9M HHs",n:1900000,conf:93,base:8,prem:32,advs:[{n:"Nike Basketball",i:"\uD83C\uDFC0",f:96},{n:"Crypto.com",i:"\uD83D\uDCB0",f:84},{n:"SoFi",i:"\uD83C\uDFE6",f:82}]},
  "Celtics Loyalist":{name:"Celtics Loyalist Households",desc:"Consistent Celtics viewership, 20%+ of NBA viewing",size:"1.4M HHs",n:1400000,conf:91,base:8,prem:30,advs:[{n:"New Balance",i:"\uD83D\uDC5F",f:94},{n:"Sam Adams",i:"\uD83C\uDF7A",f:88},{n:"Fidelity",i:"\uD83D\uDCB9",f:85}]},
  "Warriors Fan":{name:"Warriors Fan Households",desc:"Golden State Warriors concentrated viewership over multiple weeks",size:"1.6M HHs",n:1600000,conf:90,base:8,prem:30,advs:[{n:"Under Armour",i:"\uD83D\uDCAA",f:92},{n:"Google",i:"\uD83D\uDD0D",f:88},{n:"Chase",i:"\uD83C\uDFE6",f:85}]},
  "General NBA":{name:"General NBA Enthusiasts",desc:"Broad NBA viewership without strong team concentration",size:"4.5M HHs",n:4500000,conf:87,base:8,prem:20,advs:[{n:"Nike",i:"\u2714",f:92},{n:"Gatorade",i:"\u26A1",f:88},{n:"State Farm",i:"\uD83C\uDFE0",f:86}]},
  "Betting-Active":{name:"NBA Betting-Active",desc:"NBA viewers with high engagement in betting-adjacent content",size:"1.2M HHs",n:1200000,conf:89,base:8,prem:36,advs:[{n:"DraftKings",i:"\uD83C\uDFB0",f:97},{n:"FanDuel",i:"\uD83D\uDCCA",f:95}]},
  "Hardcore MMA":{name:"Hardcore MMA Households",desc:"Weekly UFC viewers \u2014 prelims, main cards, post-fight analysis",size:"1.1M HHs",n:1100000,conf:92,base:8,prem:30,advs:[{n:"Monster Energy",i:"\u26A1",f:95},{n:"Modelo",i:"\uD83C\uDF7A",f:92},{n:"P3 Protein",i:"\uD83D\uDCAA",f:85}]},
  "PPV-Only":{name:"PPV-Only Combat Fans",desc:"Only tune in for marquee PPV events",size:"3.5M HHs",n:3500000,conf:85,base:8,prem:16,advs:[{n:"ESPN+",i:"\uD83D\uDCF1",f:88},{n:"Toyo Tires",i:"\uD83C\uDFCE",f:82}]},
  "Casual Combat":{name:"Casual Combat Sports",desc:"Light viewers drawn by hype and social buzz",size:"5.0M HHs",n:5000000,conf:80,base:8,prem:12,advs:[{n:"YouTube",i:"\u25B6",f:84},{n:"DoorDash",i:"\uD83C\uDF54",f:80}]},
  "Economy-Focused":{name:"Economy-Focused Households",desc:"News viewers concentrated on economic and financial coverage",size:"3.8M HHs",n:3800000,conf:90,base:6,prem:32,advs:[{n:"Capital One",i:"\uD83D\uDCB3",f:95},{n:"Charles Schwab",i:"\uD83D\uDCB9",f:93},{n:"Goldman Sachs",i:"\uD83C\uDFE6",f:88},{n:"Fidelity",i:"\uD83D\uDCC8",f:90}]},
  "Political Junkie":{name:"Political-Engaged Households",desc:"Intense political news consumers who follow elections closely",size:"5.5M HHs",n:5500000,conf:88,base:6,prem:18,advs:[{n:"Washington Post",i:"\uD83D\uDCF0",f:85},{n:"Allstate",i:"\uD83E\uDD32",f:80}]},
  "Health-Aware":{name:"Healthcare-System-Oriented",desc:"Sustained interest in healthcare policy, pharma, wellness",size:"2.9M HHs",n:2900000,conf:87,base:6,prem:34,advs:[{n:"UnitedHealthcare",i:"\uD83C\uDFE5",f:96},{n:"CVS Health",i:"\uD83D\uDC8A",f:92},{n:"Pfizer",i:"\uD83D\uDC89",f:88},{n:"Humana",i:"\u2764",f:86}]},
  "World Affairs":{name:"World Affairs-Oriented",desc:"International news-focused viewers \u2014 geopolitics, trade",size:"1.5M HHs",n:1500000,conf:85,base:6,prem:28,advs:[{n:"Emirates",i:"\u2708",f:88},{n:"HSBC",i:"\uD83C\uDFE6",f:86}]},
  "Political-Engaged":{name:"Politically-Engaged Households",desc:"Deep political content consumers, primetime opinion viewers",size:"6.0M HHs",n:6000000,conf:87,base:6,prem:16,advs:[{n:"MyPillow",i:"\uD83D\uDECF",f:82},{n:"Progressive",i:"\uD83D\uDEE1",f:80}]},
  "Culture-Oriented":{name:"Culture & Values-Oriented",desc:"Viewers drawn to cultural commentary and values discourse",size:"3.0M HHs",n:3000000,conf:84,base:6,prem:18,advs:[{n:"Hobby Lobby",i:"\uD83C\uDFA8",f:84},{n:"Chick-fil-A",i:"\uD83D\uDC14",f:82}]},
  "Security-Minded":{name:"Security-Minded Households",desc:"Defense, security, and law enforcement content viewers",size:"2.2M HHs",n:2200000,conf:83,base:6,prem:22,advs:[{n:"USAA",i:"\uD83C\uDF96",f:94},{n:"SimpliSafe",i:"\uD83D\uDD12",f:88}]},
  "Market-Watcher":{name:"Market & Investing-Oriented",desc:"Early-riser professionals tracking markets and earnings",size:"2.1M HHs",n:2100000,conf:91,base:6,prem:38,advs:[{n:"Charles Schwab",i:"\uD83D\uDCB9",f:96},{n:"Bloomberg",i:"\uD83D\uDCCA",f:92},{n:"Masterclass",i:"\uD83C\uDF93",f:78}]},
  "Policy-Deep":{name:"Policy-Deep Households",desc:"Deep engagement in policy analysis, regulation, governance",size:"1.8M HHs",n:1800000,conf:86,base:6,prem:26,advs:[{n:"The Economist",i:"\uD83D\uDCF0",f:90},{n:"Deloitte",i:"\uD83D\uDCBC",f:85}]},
  "Media-Engaged":{name:"Media-Industry-Engaged",desc:"Meta-media consumers interested in how journalism works",size:"0.9M HHs",n:900000,conf:82,base:6,prem:24,advs:[{n:"Substack",i:"\uD83D\uDCDD",f:88},{n:"Apple News+",i:"\uD83D\uDCF1",f:85}]},
  "Early Riser Professional":{name:"Early Riser Professionals",desc:"6-9AM news viewers \u2014 high income, decision-maker skew",size:"3.5M HHs",n:3500000,conf:89,base:6,prem:34,advs:[{n:"BMW",i:"\uD83D\uDE97",f:90},{n:"Rolex",i:"\u231A",f:86},{n:"American Express",i:"\uD83D\uDCB3",f:92}]},
  "Parenting-Active":{name:"Parenting-Active Households",desc:"Longitudinal parenting segment engagement \u2014 child development, education",size:"4.5M HHs",n:4500000,conf:91,base:5,prem:26,advs:[{n:"Procter & Gamble",i:"\uD83E\uDDF4",f:96},{n:"Target",i:"\uD83C\uDFAF",f:92},{n:"Disney+",i:"\uD83C\uDFF0",f:90},{n:"Johnson & Johnson",i:"\uD83D\uDC76",f:88}]},
  "Cooking Enthusiast":{name:"Cooking Enthusiasts",desc:"Recurring cooking segment viewers, recipe-oriented",size:"3.2M HHs",n:3200000,conf:88,base:5,prem:22,advs:[{n:"HelloFresh",i:"\uD83E\uDD57",f:94},{n:"KitchenAid",i:"\uD83C\uDF73",f:90},{n:"Whole Foods",i:"\uD83E\uDD51",f:86}]},
  "Health-Oriented":{name:"Preventative Health-Oriented",desc:"Sustained wellness/health segment viewers",size:"3.8M HHs",n:3800000,conf:89,base:5,prem:30,advs:[{n:"CVS Health",i:"\uD83D\uDC8A",f:94},{n:"Peloton",i:"\uD83D\uDEB4",f:90},{n:"Lululemon",i:"\uD83E\uDDD8",f:86}]},
  "Travel-Aspirational":{name:"Travel-Aspirational Households",desc:"High engagement with travel segments and destinations",size:"2.6M HHs",n:2600000,conf:85,base:5,prem:28,advs:[{n:"Marriott Bonvoy",i:"\uD83C\uDFE8",f:94},{n:"Delta Airlines",i:"\u2708",f:90},{n:"Expedia",i:"\uD83C\uDF0D",f:88}]},
  "Family-Focused":{name:"Family-Focused Households",desc:"Broad family lifestyle viewers \u2014 education, activities",size:"5.8M HHs",n:5800000,conf:90,base:5,prem:22,advs:[{n:"Walmart",i:"\uD83D\uDED2",f:92},{n:"Disney+",i:"\uD83C\uDFF0",f:90},{n:"State Farm",i:"\uD83C\uDFE0",f:86}]},
  "Wellness-Oriented":{name:"Wellness-Oriented Households",desc:"Mental health, mindfulness, holistic wellness consumers",size:"3.0M HHs",n:3000000,conf:87,base:5,prem:26,advs:[{n:"Calm",i:"\uD83E\uDDD8",f:94},{n:"Whole Foods",i:"\uD83E\uDD51",f:88},{n:"Lululemon",i:"\uD83D\uDC5F",f:86}]},
  "Home Improver":{name:"Home Upgrade-Oriented",desc:"Sustained home improvement and DIY segment engagement",size:"4.0M HHs",n:4000000,conf:89,base:5,prem:28,advs:[{n:"Home Depot",i:"\uD83D\uDD28",f:97},{n:"Lowe's",i:"\uD83C\uDFE1",f:95},{n:"Wayfair",i:"\uD83D\uDECB",f:88}]},
  "Finance-Aware":{name:"Consumer Finance-Aware",desc:"Personal finance, budgeting, investment segment engagement",size:"2.8M HHs",n:2800000,conf:86,base:5,prem:32,advs:[{n:"Capital One",i:"\uD83D\uDCB3",f:94},{n:"Mint/Intuit",i:"\uD83D\uDCCA",f:90},{n:"Vanguard",i:"\uD83D\uDCC8",f:86}]},
  "Culture-Engaged":{name:"Culture-Engaged Households",desc:"Pop culture, social trends, cultural commentary viewers",size:"3.5M HHs",n:3500000,conf:85,base:5,prem:18,advs:[{n:"Netflix",i:"\uD83C\uDFAC",f:88},{n:"Spotify",i:"\uD83C\uDFB5",f:86}]},
  "Politically-Active":{name:"Politically-Active Households",desc:"Cross-network political consumers, multiple angles",size:"4.2M HHs",n:4200000,conf:86,base:5,prem:20,advs:[{n:"New York Times",i:"\uD83D\uDCF0",f:87},{n:"T-Mobile",i:"\uD83D\uDCF1",f:78}]},
  "Celebrity-Follower":{name:"Celebrity-Follower Households",desc:"Celebrity news, entertainment gossip, star-driven content",size:"4.2M HHs",n:4200000,conf:83,base:5,prem:16,advs:[{n:"Sephora",i:"\uD83D\uDC84",f:88},{n:"Fashion Nova",i:"\uD83D\uDC57",f:84}]},
  "Health-Conscious":{name:"Health-Conscious Daytime",desc:"Daytime viewers with strong health content affinity",size:"2.5M HHs",n:2500000,conf:86,base:5,prem:24,advs:[{n:"Walgreens",i:"\uD83D\uDC8A",f:90},{n:"Fitbit",i:"\u231A",f:86}]},
  "Romance-Engaged":{name:"Romance-Engaged Households",desc:"High engagement with romance/relationship programming",size:"3.8M HHs",n:3800000,conf:88,base:5,prem:20,advs:[{n:"Hallmark",i:"\uD83D\uDC8C",f:92},{n:"Kay Jewelers",i:"\uD83D\uDC8E",f:90},{n:"Hinge",i:"\u2764",f:86}]},
  "Drama-Seeker":{name:"Drama-Seeker Households",desc:"Viewers drawn to high-conflict, emotional storytelling",size:"5.0M HHs",n:5000000,conf:84,base:5,prem:14,advs:[{n:"Hulu",i:"\uD83D\uDCFA",f:86},{n:"Peacock",i:"\uD83E\uDD9A",f:84}]},
  "Fashion-Forward":{name:"Fashion-Forward Households",desc:"Fashion, style, beauty content-engaged viewers",size:"2.0M HHs",n:2000000,conf:86,base:5,prem:30,advs:[{n:"Nordstrom",i:"\uD83D\uDC57",f:94},{n:"Sephora",i:"\uD83D\uDC84",f:92},{n:"Gucci",i:"\uD83D\uDC5C",f:86}]},
  "Strategy-Obsessed":{name:"Strategy-Obsessed Households",desc:"Competition/strategy reality viewers, analytically minded",size:"2.8M HHs",n:2800000,conf:87,base:5,prem:20,advs:[{n:"REI",i:"\u26FA",f:88},{n:"The North Face",i:"\uD83C\uDFD4",f:86},{n:"Masterclass",i:"\uD83C\uDF93",f:82}]},
  "Adventure-Seeker":{name:"Adventure-Seeker Households",desc:"Outdoor, adventure, physical challenge content consumers",size:"3.2M HHs",n:3200000,conf:85,base:5,prem:22,advs:[{n:"Jeep",i:"\uD83D\uDE99",f:92},{n:"GoPro",i:"\uD83D\uDCF7",f:90},{n:"Patagonia",i:"\uD83C\uDFD4",f:88}]},
  "Social Dynamics Fan":{name:"Social Dynamics Fans",desc:"Viewers engaged by interpersonal dynamics and alliances",size:"4.0M HHs",n:4000000,conf:83,base:5,prem:16,advs:[{n:"Bumble",i:"\uD83D\uDC1D",f:84},{n:"Netflix",i:"\uD83C\uDFAC",f:82}]},
  "Fitness-Oriented":{name:"Fitness-Oriented Households",desc:"Physical fitness and athletic performance content consumers",size:"2.4M HHs",n:2400000,conf:86,base:5,prem:26,advs:[{n:"Nike Training",i:"\uD83D\uDCAA",f:94},{n:"Peloton",i:"\uD83D\uDEB4",f:92},{n:"GNC",i:"\uD83D\uDC8A",f:86}]}
};

// ─── STATE ───────────────────────────────────────────────────────────────────
var state = { step: 0, envId: null, showId: null, clusters: [] };
function getEnv() { return ENVS.find(function(e){ return e.id === state.envId; }); }
function getShow() { var e = getEnv(); return e ? e.shows.find(function(s){ return s.id === state.showId; }) : null; }
function setState(patch) { for (var k in patch) state[k] = patch[k]; render(); }

// ─── HELPERS ─────────────────────────────────────────────────────────────────
function h(tag, attrs, children) {
  var el = document.createElement(tag);
  if (attrs) for (var k in attrs) {
    if (k === 'onclick') el.onclick = attrs[k];
    else if (k === 'className') el.className = attrs[k];
    else if (k === 'innerHTML') el.innerHTML = attrs[k];
    else el.style[k] = attrs[k];
  }
  if (typeof children === 'string') el.textContent = children;
  else if (Array.isArray(children)) children.forEach(function(c){ if(c) el.appendChild(c); });
  else if (children instanceof HTMLElement) el.appendChild(children);
  return el;
}

function fmtSize(n) { return n >= 1e6 ? (n/1e6).toFixed(1)+'M' : (n/1e3).toFixed(0)+'K'; }

function buildStackedChart(show) {
  var wrap = h('div', {className:'stacked-chart'});
  var maxTotal = 100;
  show.data.forEach(function(d) {
    var col = h('div', {className:'stacked-col'});
    var total = d.vals.reduce(function(a,b){return a+b;},0);
    var stack = h('div', {display:'flex', flexDirection:'column-reverse', width:'100%', height:(total/maxTotal*160)+'px'});
    d.vals.forEach(function(v, i) {
      var seg = h('div', {className:'stacked-bar', background:COLORS[i%COLORS.length], height:(v/total*100)+'%', width:'100%', minHeight:'2px'});
      stack.appendChild(seg);
    });
    col.appendChild(stack);
    col.appendChild(h('div', {className:'stacked-label'}, d.w));
    wrap.appendChild(col);
  });
  var legend = h('div', {className:'chart-legend'});
  show.keys.forEach(function(k, i) {
    var item = h('div', {className:'legend-item'});
    item.appendChild(h('div', {className:'legend-dot', background:COLORS[i%COLORS.length]}));
    item.appendChild(h('span', null, k));
    legend.appendChild(item);
  });
  var container = h('div');
  container.appendChild(wrap);
  container.appendChild(legend);
  return container;
}

function buildBarChart(items, maxVal) {
  var wrap = h('div', {className:'bar-chart'});
  items.forEach(function(item) {
    var row = h('div', {className:'bar-row'});
    row.appendChild(h('div', {className:'bar-label'}, item.label));
    var cont = h('div', {className:'bar-container'});
    cont.appendChild(h('div', {className:'bar', background:'#d1d5db', width:(item.base/maxVal*100)+'%'}));
    cont.appendChild(h('div', {className:'bar', background:'#2563eb', width:(item.prem/maxVal*100)+'%'}));
    row.appendChild(cont);
    var vals = h('div', {});
    vals.innerHTML = '<span style="font-size:10px;color:#9ca3af">$'+item.base+'</span> <span style="font-size:10px;color:#2563eb;font-weight:600">$'+item.prem+'</span>';
    row.appendChild(vals);
    wrap.appendChild(row);
  });
  var legend = h('div', {display:'flex', gap:'16px', marginTop:'8px'});
  legend.innerHTML = '<span style="font-size:10px;color:#9ca3af">\u25A0 EPG CPM</span><span style="font-size:10px;color:#2563eb">\u25A0 BluePrint CPM</span>';
  wrap.appendChild(legend);
  return wrap;
}

// ─── RENDER ──────────────────────────────────────────────────────────────────
function render() {
  var app = document.getElementById('app');
  app.innerHTML = '';

  // Header
  var header = h('div', {className:'header'});
  var hLeft = h('div', {className:'header-left'});
  hLeft.appendChild(h('div', {className:'header-logo'}, 'B'));
  var hText = h('div');
  hText.appendChild(h('div', {className:'header-title'}, 'BluePrint AI'));
  hText.appendChild(h('div', {className:'header-sub'}, 'Advanced Audience Segmentation'));
  hLeft.appendChild(hText);
  header.appendChild(hLeft);
  var hBadges = h('div', {className:'badges'});
  hBadges.innerHTML = '<span class="badge badge-solid" style="background:#3b82f6">VIDEO AI ANALYTICS</span><span class="badge badge-solid" style="background:#8b5cf6">INTERACTIVE DEMO</span>';
  header.appendChild(hBadges);
  app.appendChild(header);

  // Stepper
  var labels = ['Content Environment','Program Selection','BluePrint Intelligence','Audience Detail'];
  var stepper = h('div', {className:'stepper'});
  if (state.step > 0) {
    var backBtn = h('button', {className:'btn-back', onclick:function(){
      if(state.step===3) setState({step:2});
      else if(state.step===2) setState({step:1,showId:null,clusters:[]});
      else if(state.step===1) setState({step:0,envId:null});
    }}, '\u2190 Back');
    stepper.appendChild(backBtn);
  }
  labels.forEach(function(l,i) {
    var circle = h('div', {className:'step-circle', background:i<=state.step?'#2563eb':'#e5e7eb', color:i<=state.step?'#fff':'#9ca3af'}, i<state.step?'\u2713':''+(i+1));
    stepper.appendChild(circle);
    stepper.appendChild(h('span', {className:'step-label', color:i===state.step?'#111827':'#9ca3af', fontWeight:i===state.step?'600':'400'}, l));
    if (i<labels.length-1) stepper.appendChild(h('div', {className:'step-line', background:i<state.step?'#2563eb':'#e5e7eb'}));
  });
  if (state.step > 0) stepper.appendChild(h('button', {className:'btn-reset', onclick:function(){setState({step:0,envId:null,showId:null,clusters:[]});}}, 'Start Over'));
  app.appendChild(stepper);

  // Content
  var content = h('div', {className:'content'});

  if (state.step === 0) renderStep0(content);
  else if (state.step === 1) renderStep1(content);
  else if (state.step === 2) renderStep2(content);
  else if (state.step === 3) renderStep3(content);

  app.appendChild(content);

  // Footer
  var footer = h('div', {className:'footer'});
  footer.innerHTML = '<div>CCR Media Cloud \u00B7 BluePrint AI \u00B7 CONFIDENTIAL</div><div>Interactive Demo \u2014 Mock Data for Illustration</div>';
  app.appendChild(footer);
}

function renderStep0(parent) {
  var hdr = h('div', {marginBottom:'24px'});
  hdr.appendChild(h('h2', {fontSize:'22px',fontWeight:'700',margin:'0 0 4px 0'}, 'Select Content Environment'));
  hdr.appendChild(h('p', {color:'#6b7280',fontSize:'14px',margin:'0'}, 'EPG says "Sports" \u2014 BluePrint Intelligence (built longitudinally) says "NBA-Dominant Households"'));
  parent.appendChild(hdr);

  var grid = h('div', {className:'grid-2'});
  ENVS.forEach(function(env) {
    var card = h('div', {className:'card card-hover card-click env-card', onclick:function(){setState({step:1,envId:env.id,showId:null,clusters:[]});}});
    card.appendChild(h('div', {className:'env-stripe', background:env.color}));
    var row = h('div', {display:'flex',alignItems:'center',gap:'12px',marginBottom:'12px',paddingLeft:'8px'});
    row.appendChild(h('span', {fontSize:'28px'}, env.icon));
    var info = h('div');
    info.appendChild(h('div', {fontSize:'16px',fontWeight:'600'}, env.name));
    var badges = h('div', {display:'flex',gap:'8px',marginTop:'4px'});
    badges.innerHTML = '<span class="badge badge-outline" style="border:1.5px solid #9ca3af;color:#9ca3af">EPG: '+env.epg+'</span><span class="badge badge-outline" style="border:1.5px solid '+env.color+';color:'+env.color+'">'+env.shows.length+' Programs</span>';
    info.appendChild(badges);
    row.appendChild(info);
    card.appendChild(row);
    var tags = h('div', {paddingLeft:'8px',display:'flex',flexWrap:'wrap',gap:'4px'});
    env.shows.forEach(function(s){ tags.appendChild(h('span', {className:'show-tag'}, s.name)); });
    card.appendChild(tags);
    grid.appendChild(card);
  });
  parent.appendChild(grid);

  var insight = h('div', {className:'insight-box'});
  insight.innerHTML = '<div style="font-size:20px;margin-top:2px">\uD83D\uDCA1</div><div><div style="font-weight:600;font-size:14px;margin-bottom:4px">Why BluePrint Changes Everything</div><div style="font-size:13px;color:#4b5563;line-height:1.5">Traditional EPG metadata gives you genre labels. BluePrint AI analyzes viewing patterns <strong>longitudinally over weeks</strong> \u2014 detecting what households actually care about, not just what channel they\'re on. This turns a $8 CPM "Sports" audience into a $28-38 CPM "NBA-Dominant" or "Betting-Engaged" audience.</div></div>';
  parent.appendChild(insight);
}

function renderStep1(parent) {
  var env = getEnv();
  var hdr = h('div', {marginBottom:'24px',display:'flex',alignItems:'center',gap:'12px'});
  hdr.appendChild(h('span', {fontSize:'28px'}, env.icon));
  var info = h('div');
  info.appendChild(h('h2', {fontSize:'22px',fontWeight:'700',margin:'0'}, env.name));
  info.innerHTML += '<div style="margin-top:4px"><span class="badge badge-outline" style="border:1.5px solid #9ca3af;color:#9ca3af">EPG Label: '+env.epg+'</span></div>';
  hdr.appendChild(info);
  parent.appendChild(hdr);

  var grid = h('div', {className:'grid-2'});
  env.shows.forEach(function(show) {
    var card = h('div', {className:'card card-hover card-click', onclick:function(){setState({step:2,showId:show.id,clusters:[]});}});
    var top = h('div', {display:'flex',justifyContent:'space-between',alignItems:'flex-start',marginBottom:'12px'});
    var tl = h('div');
    tl.appendChild(h('div', {fontSize:'16px',fontWeight:'600'}, show.name));
    tl.appendChild(h('div', {fontSize:'12px',color:'#6b7280'}, show.net+' \u00B7 '+show.slots));
    top.appendChild(tl);
    top.innerHTML += '<span class="badge badge-solid" style="background:'+env.color+'">'+show.clusters.length+' Segments</span>';
    card.appendChild(top);
    card.appendChild(h('div', {fontSize:'12px',color:'#6b7280',marginBottom:'12px'}, 'BluePrint detects '+show.clusters.length+' distinct audience clusters:'));
    var tags = h('div', {display:'flex',flexWrap:'wrap',gap:'6px'});
    show.clusters.forEach(function(c,i){ tags.innerHTML += '<span class="badge badge-outline" style="border:1.5px solid '+COLORS[i%COLORS.length]+';color:'+COLORS[i%COLORS.length]+'">'+c+'</span>'; });
    card.appendChild(tags);
    grid.appendChild(card);
  });
  parent.appendChild(grid);
}

function renderStep2(parent) {
  var env = getEnv(), show = getShow();

  var hdr = h('div', {display:'flex',justifyContent:'space-between',alignItems:'flex-start',marginBottom:'20px'});
  var hl = h('div');
  hl.appendChild(h('div', {fontSize:'12px',color:'#6b7280',marginBottom:'4px'}, env.icon+' '+env.name));
  hl.appendChild(h('h2', {fontSize:'22px',fontWeight:'700',margin:'0'}, show.name));
  hl.appendChild(h('div', {fontSize:'13px',color:'#6b7280',marginTop:'2px'}, show.net+' \u00B7 '+show.slots));
  hdr.appendChild(hl);
  var hr = h('div', {textAlign:'right'});
  hr.appendChild(h('div', {fontSize:'11px',color:'#6b7280',marginBottom:'4px'}, 'LONGITUDINAL ANALYSIS'));
  hr.innerHTML += '<span class="badge badge-solid" style="background:#059669">6-Week Window</span>';
  hdr.appendChild(hr);
  parent.appendChild(hdr);

  // Side by side
  var side = h('div', {className:'grid-side', marginBottom:'20px'});
  var epgCard = h('div', {className:'card epg-card'});
  epgCard.innerHTML = '<div class="epg-label">What EPG Sees</div><div class="epg-value">'+env.epg+'</div><div class="epg-desc">Single genre label. One audience. One CPM.</div><div class="epg-cpm"><div style="font-size:11px;color:#92400e">Typical CPM</div><div style="font-size:24px;font-weight:700;color:#92400e">$6\u20138</div></div>';
  side.appendChild(epgCard);
  var bpCard = h('div', {className:'card'});
  bpCard.appendChild(h('div', {className:'bp-label'}, 'What BluePrint Sees \u2014 Viewing Patterns Over 6 Weeks'));
  bpCard.appendChild(buildStackedChart(show));
  side.appendChild(bpCard);
  parent.appendChild(side);

  // Cluster selection
  var builder = h('div', {className:'card', marginBottom:'16px'});
  var bTop = h('div', {display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'16px'});
  var bInfo = h('div');
  bInfo.appendChild(h('div', {fontSize:'14px',fontWeight:'600'}, 'Build Your Audience'));
  bInfo.appendChild(h('div', {fontSize:'12px',color:'#6b7280'}, 'Select one or more AI-detected audience clusters'));
  bTop.appendChild(bInfo);
  if (state.clusters.length > 0) {
    bTop.appendChild(h('button', {className:'btn-create', onclick:function(){setState({step:3});}}, 'Create Audience ('+state.clusters.length+' selected) \u2192'));
  }
  builder.appendChild(bTop);

  var cGrid = h('div', {className:'grid-2', gap:'10px'});
  show.clusters.forEach(function(cluster, i) {
    var ad = AUD[cluster];
    var sel = state.clusters.indexOf(cluster) >= 0;
    var item = h('div', {className:'cluster-item', border:sel?'2px solid '+COLORS[i%COLORS.length]:'1.5px solid #e5e7eb', background:sel?COLORS[i%COLORS.length]+'08':'#fff', onclick:function(){
      var idx = state.clusters.indexOf(cluster);
      var next = state.clusters.slice();
      if(idx>=0) next.splice(idx,1); else next.push(cluster);
      setState({clusters:next});
    }});
    var left = h('div', {display:'flex',alignItems:'center',gap:'12px'});
    left.appendChild(h('div', {className:'cluster-check', border:'2px solid '+(sel?COLORS[i%COLORS.length]:'#d1d5db'), background:sel?COLORS[i%COLORS.length]:'#fff'}, sel?'\u2713':''));
    var lInfo = h('div');
    lInfo.appendChild(h('div', {fontSize:'13px',fontWeight:'600'}, ad?ad.name:cluster));
    lInfo.appendChild(h('div', {fontSize:'11px',color:'#6b7280',marginTop:'2px'}, ad?ad.size:'\u2014'));
    left.appendChild(lInfo);
    item.appendChild(left);
    var right = h('div', {textAlign:'right'});
    right.appendChild(h('div', {fontSize:'11px',color:'#6b7280'}, 'Premium CPM'));
    right.appendChild(h('div', {fontSize:'16px',fontWeight:'700',color:COLORS[i%COLORS.length]}, '$'+(ad?ad.prem:'\u2014')));
    item.appendChild(right);
    cGrid.appendChild(item);
  });
  builder.appendChild(cGrid);
  parent.appendChild(builder);
}

function renderStep3(parent) {
  var env = getEnv(), show = getShow();
  var auds = state.clusters.map(function(c){return AUD[c];}).filter(Boolean);
  if(!auds.length) return;
  var totalN = auds.reduce(function(s,a){return s+a.n;},0);
  var avgConf = Math.round(auds.reduce(function(s,a){return s+a.conf;},0)/auds.length);
  var avgBase = Math.round(auds.reduce(function(s,a){return s+a.base;},0)/auds.length);
  var avgPrem = Math.round(auds.reduce(function(s,a){return s+a.prem;},0)/auds.length);
  var allAdv = {};
  auds.forEach(function(a){a.advs.forEach(function(ad){if(!allAdv[ad.n]||allAdv[ad.n].f<ad.f)allAdv[ad.n]=ad;});});
  var topAdv = Object.keys(allAdv).map(function(k){return allAdv[k];}).sort(function(a,b){return b.f-a.f;}).slice(0,6);

  var hdr = h('div', {marginBottom:'20px'});
  hdr.appendChild(h('div', {fontSize:'12px',color:'#6b7280',marginBottom:'4px'}, env.icon+' '+env.name+' \u2192 '+show.name));
  hdr.appendChild(h('h2', {fontSize:'22px',fontWeight:'700',margin:'0'}, state.clusters.length===1?AUD[state.clusters[0]].name:'Custom Audience ('+state.clusters.length+' Clusters)'));
  parent.appendChild(hdr);

  // KPIs
  var kpis = h('div', {className:'grid-4', marginBottom:'20px'});
  [{l:'Addressable HHs',v:fmtSize(totalN),s:'Deduplicated reach',c:'#2563eb'},
   {l:'Confidence Score',v:avgConf+'%',s:'Longitudinal certainty',c:'#059669'},
   {l:'EPG CPM',v:'$'+avgBase,s:'Basic genre targeting',c:'#9ca3af'},
   {l:'BluePrint CPM',v:'$'+avgPrem,s:Math.round((avgPrem/avgBase-1)*100)+'% premium',c:'#7c3aed'}
  ].forEach(function(k){
    var card = h('div', {className:'card'});
    card.appendChild(h('div', {className:'kpi-label'}, k.l));
    card.appendChild(h('div', {className:'kpi-value', color:k.c}, k.v));
    card.appendChild(h('div', {className:'kpi-sub'}, k.s));
    kpis.appendChild(card);
  });
  parent.appendChild(kpis);

  // Charts row
  var charts = h('div', {className:'grid-2', marginBottom:'20px'});
  var chartCard = h('div', {className:'card'});
  chartCard.appendChild(h('div', {fontSize:'13px',fontWeight:'600',marginBottom:'12px'}, 'CPM Uplift by Cluster'));
  var maxCpm = auds.reduce(function(m,a){return Math.max(m,a.prem);},0);
  var barData = auds.map(function(a,i){return {label:state.clusters[i].length>20?state.clusters[i].substring(0,18)+'\u2026':state.clusters[i],base:a.base,prem:a.prem};});
  chartCard.appendChild(buildBarChart(barData, maxCpm+5));
  charts.appendChild(chartCard);

  var advCard = h('div', {className:'card'});
  advCard.appendChild(h('div', {fontSize:'13px',fontWeight:'600',marginBottom:'12px'}, 'Matched Advertisers'));
  topAdv.forEach(function(ad){
    var row = h('div', {className:'adv-row'});
    row.appendChild(h('div', {className:'adv-icon'}, ad.i));
    var info = h('div', {flex:'1'});
    var top = h('div', {display:'flex',justifyContent:'space-between',marginBottom:'3px'});
    top.appendChild(h('span', {fontSize:'13px',fontWeight:'500'}, ad.n));
    top.appendChild(h('span', {fontSize:'11px',color:'#059669',fontWeight:'600'}, ad.f+'% fit'));
    info.appendChild(top);
    var bar = h('div', {className:'adv-bar-bg'});
    bar.appendChild(h('div', {className:'adv-bar-fill', width:ad.f+'%'}));
    info.appendChild(bar);
    row.appendChild(info);
    advCard.appendChild(row);
  });
  charts.appendChild(advCard);
  parent.appendChild(charts);

  // Revenue model
  var rev = h('div', {className:'card revenue-card', marginBottom:'20px'});
  rev.appendChild(h('div', {fontSize:'13px',fontWeight:'600',marginBottom:'16px',color:'#94a3b8',textTransform:'uppercase',letterSpacing:'0.5px'}, 'Revenue Impact Model'));
  var revGrid = h('div', {display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:'24px'});
  var imps = (totalN*30/1e6).toFixed(0);
  var revBase = (totalN*30/1e3*avgBase/1e6).toFixed(1);
  var revPrem = (totalN*30/1e3*avgPrem/1e6).toFixed(1);
  var revIncr = (totalN*30/1e3*(avgPrem-avgBase)/1e6).toFixed(1);
  [{l:'Monthly Impressions (Est.)',v:imps+'M',s:'Based on 1 imp/HH/day avg',vc:'#fff'},
   {l:'Monthly Revenue @ EPG CPM',v:'$'+revBase+'M',s:'Current yield',vc:'#94a3b8'},
   {l:'Monthly Revenue @ BluePrint CPM',v:'$'+revPrem+'M',s:'+$'+revIncr+'M incremental',vc:'#3b82f6'}
  ].forEach(function(r){
    var col = h('div');
    col.appendChild(h('div', {className:'rev-label'}, r.l));
    col.appendChild(h('div', {fontSize:'24px',fontWeight:'700',color:r.vc}, r.v));
    col.appendChild(h('div', {className:'rev-sub', color:r.vc==='#3b82f6'?'#60a5fa':'#64748b'}, r.s));
    revGrid.appendChild(col);
  });
  rev.appendChild(revGrid);
  parent.appendChild(rev);

  // Segments
  if (state.clusters.length > 1) {
    var segCard = h('div', {className:'card', marginBottom:'20px'});
    segCard.appendChild(h('div', {fontSize:'13px',fontWeight:'600',marginBottom:'12px'}, 'Included Segments'));
    var segGrid = h('div', {className:'grid-2', gap:'10px'});
    auds.forEach(function(a){
      var box = h('div', {className:'segment-box'});
      box.appendChild(h('div', {fontSize:'13px',fontWeight:'600',marginBottom:'4px'}, a.name));
      box.appendChild(h('div', {fontSize:'11px',color:'#6b7280',marginBottom:'8px'}, a.desc));
      box.innerHTML += '<div style="display:flex;gap:12px"><span style="font-size:11px">\uD83D\uDCCA '+a.size+'</span><span style="font-size:11px">\uD83C\uDFAF '+a.conf+'% confidence</span><span style="font-size:11px">\uD83D\uDCB0 $'+a.prem+' CPM</span></div>';
      segGrid.appendChild(box);
    });
    segCard.appendChild(segGrid);
    parent.appendChild(segCard);
  }

  // Samsung callout
  var samsung = h('div', {className:'samsung-callout'});
  samsung.appendChild(h('div', {className:'samsung-dot'}, '\u25C9'));
  var sInfo = h('div');
  sInfo.appendChild(h('div', {fontSize:'14px',fontWeight:'700',color:'#065f46'}, '"Samsung Audiences" \u2014 Programmatic & Direct'));
  sInfo.appendChild(h('div', {fontSize:'12px',color:'#047857'}, 'AI-enabled premium longitudinal audiences sold via OEM DSP or Direct. Built over weeks/months of viewing (\'EPG on steroids\').'));
  samsung.appendChild(sInfo);
  parent.appendChild(samsung);
}

// Boot
render();
</script>
</body>
</html>
